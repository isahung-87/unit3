<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Grey Parrot: Listening Lab</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; }
        .tab-active { border-bottom: 2px solid #2563eb; color: #2563eb; font-weight: 600; }
        .tab-inactive { color: #6b7280; }
        .card-hover { transition: transform 0.2s; }
        .card-hover:hover { transform: translateY(-2px); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 資料來源 (Data Source) ---
        const ARTICLE = {
            title: "The Grey Parrot: A Brilliant Bird with a Lot to Say",
            content: `Often called the most intelligent bird in the world, the grey parrot charms with its soft feathers and curious eyes. What truly makes it stand out, however, is its sharp memory and remarkable learning ability. One of these parrots’ most impressive talents is mimicking human voices. They can learn hundreds of words and also imitate tone and emotion. Scientists have even studied their problem-solving skills and learning capacity. The most famous example, a parrot named Alex, could count, recognize colors, and answer simple questions—proving that these birds understand far more than once believed. Native to Africa, the parrot has long been celebrated in African mythology. Among the Yoruba people, grey parrots are linked to royalty and spiritual messages, with their feathers used in rituals to communicate with the gods. In Ashanti folklore, they serve as messengers between the living and the spirit world, a sign of deep cultural respect. Today, though still honored in legends, grey parrots face threats from habitat loss and illegal trade that have caused their numbers in the wild to plummet. While they remain beloved companions in homes worldwide, these brilliant birds need urgent protection to secure their future.`
        };

        const VOCABULARY = [
            { word: "mimic", def: "To copy the way someone speaks or moves.", example: "The bird can mimic a ringing phone." },
            { word: "capacity", def: "The ability to understand or do something.", example: "She has a great capacity for learning languages." },
            { word: "mythology", def: "Ancient stories and beliefs.", example: "Greek mythology is full of gods and heroes." },
            { word: "ritual", def: "A ceremony that is always performed in the same way.", example: "Morning coffee is my daily ritual." },
            { word: "plummet", def: "To fall very quickly and suddenly.", example: "Temperatures plummeted last night." },
            { word: "companion", def: "A person or animal you spend time with.", example: "Dogs are loyal companions." }
        ];

        const QUIZ_QUESTIONS = [
            {
                id: 1,
                question: "According to the article, what is the grey parrot's most impressive talent?",
                options: [
                    "Flying very fast",
                    "Mimicking human voices",
                    "Building large nests",
                    "Hunting for food"
                ],
                correct: 1
            },
            {
                id: 2,
                question: "Who was Alex?",
                options: [
                    "A scientist who studied birds",
                    "A god in African mythology",
                    "A famous parrot that could count and recognize colors",
                    "A king of the Yoruba people"
                ],
                correct: 2
            },
            {
                id: 3,
                question: "In Yoruba culture, what are grey parrot feathers used for?",
                options: [
                    "Making clothes for royalty",
                    "Decorating homes",
                    "Rituals to communicate with gods",
                    "Trading for food"
                ],
                correct: 2
            },
            {
                id: 4,
                question: "Why have grey parrot numbers dropped in the wild?",
                options: [
                    "Climate change and storms",
                    "Habitat loss and illegal trade",
                    "Lack of food sources",
                    "Competition with other birds"
                ],
                correct: 1
            }
        ];

        const DICTATION_SENTENCE = "The grey parrot is often called the most intelligent bird in the world.";

        // --- icons ---
        const Icon = ({ name, size = 20, color = "currentColor" }) => {
            useEffect(() => {
                lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} width={size} height={size} style={{ color }}></i>;
        };

        // --- Components ---

        const Header = () => (
            <header className="bg-teal-600 text-white p-6 shadow-md">
                <div className="max-w-4xl mx-auto flex items-center justify-between">
                    <div>
                        <h1 className="text-2xl font-bold flex items-center gap-2">
                            <Icon name="headphones" size={28} />
                            English Listening Lab
                        </h1>
                        <p className="text-teal-100 text-sm mt-1">Topic: {ARTICLE.title}</p>
                    </div>
                    <div className="text-xs bg-teal-700 px-3 py-1 rounded-full">
                        Level: Intermediate
                    </div>
                </div>
            </header>
        );

        const AudioControls = ({ text, isPlaying, setIsPlaying, rate, setRate, onEnd }) => {
            const speak = () => {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = rate;
                utterance.onend = () => {
                    setIsPlaying(false);
                    if(onEnd) onEnd();
                };
                window.speechSynthesis.speak(utterance);
                setIsPlaying(true);
            };

            const stop = () => {
                window.speechSynthesis.cancel();
                setIsPlaying(false);
            };

            const togglePlay = () => {
                if (isPlaying) {
                    stop();
                } else {
                    speak();
                }
            };

            return (
                <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-6 flex flex-wrap items-center justify-between gap-4">
                    <div className="flex items-center gap-3">
                        <button 
                            onClick={togglePlay}
                            className={`flex items-center gap-2 px-6 py-2 rounded-full font-semibold transition-colors ${isPlaying ? 'bg-red-100 text-red-600 hover:bg-red-200' : 'bg-teal-600 text-white hover:bg-teal-700'}`}
                        >
                            <Icon name={isPlaying ? "pause" : "play"} />
                            {isPlaying ? "Pause" : "Listen"}
                        </button>
                        
                        <button 
                            onClick={stop}
                            className="p-2 text-gray-500 hover:text-red-500 rounded-full hover:bg-gray-100"
                            title="Stop"
                        >
                            <Icon name="square" size={18} />
                        </button>
                    </div>

                    <div className="flex items-center gap-2 text-sm text-gray-600 bg-gray-50 px-3 py-1 rounded-lg">
                        <Icon name="gauge" size={16} />
                        <span>Speed:</span>
                        {[0.8, 1.0, 1.2].map(r => (
                            <button
                                key={r}
                                onClick={() => {
                                    setRate(r);
                                    if(isPlaying) {
                                        window.speechSynthesis.cancel();
                                        setTimeout(() => document.getElementById('play-btn')?.click(), 100); 
                                        // Simple hack: re-trigger play manually or just let user click play again. 
                                        // Better UX: stop, set rate.
                                        setIsPlaying(false); 
                                    }
                                }}
                                className={`px-2 py-0.5 rounded ${rate === r ? 'bg-teal-600 text-white' : 'hover:bg-gray-200'}`}
                            >
                                {r}x
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const VocabularyTab = () => {
            const playWord = (text) => {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'en-US';
                window.speechSynthesis.speak(u);
            };

            return (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {VOCABULARY.map((item, idx) => (
                        <div key={idx} className="bg-white p-5 rounded-xl shadow-sm border border-gray-100 card-hover group">
                            <div className="flex justify-between items-start">
                                <h3 className="text-xl font-bold text-gray-800">{item.word}</h3>
                                <button 
                                    onClick={() => playWord(item.word)}
                                    className="p-2 bg-teal-50 text-teal-600 rounded-full hover:bg-teal-100 transition-colors"
                                >
                                    <Icon name="volume-2" size={20} />
                                </button>
                            </div>
                            <p className="text-sm text-gray-500 mt-1 italic">{item.def}</p>
                            <div className="mt-3 text-sm bg-gray-50 p-2 rounded text-gray-700 border-l-4 border-teal-400">
                                "{item.example}"
                            </div>
                        </div>
                    ))}
                </div>
            );
        };

        const ListeningTab = () => {
            const [isPlaying, setIsPlaying] = useState(false);
            const [rate, setRate] = useState(1.0);
            const [showText, setShowText] = useState(false);

            // Cleanup audio on unmount
            useEffect(() => {
                return () => window.speechSynthesis.cancel();
            }, []);

            return (
                <div className="max-w-3xl mx-auto">
                    <AudioControls 
                        text={ARTICLE.content} 
                        isPlaying={isPlaying} 
                        setIsPlaying={setIsPlaying}
                        rate={rate}
                        setRate={setRate}
                    />
                    
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div className="flex justify-between items-center mb-4 border-b pb-4">
                            <h3 className="font-bold text-gray-700 flex items-center gap-2">
                                <Icon name="file-text" size={18} />
                                Transcript
                            </h3>
                            <button 
                                onClick={() => setShowText(!showText)}
                                className="text-sm text-teal-600 hover:underline flex items-center gap-1"
                            >
                                {showText ? <><Icon name="eye-off" size={14}/> Hide</> : <><Icon name="eye" size={14}/> Show</>}
                            </button>
                        </div>
                        
                        <div className={`leading-loose text-gray-800 transition-all duration-300 ${showText ? 'opacity-100' : 'opacity-0 h-32 overflow-hidden filter blur-sm select-none'}`}>
                            {ARTICLE.content}
                        </div>
                        
                        {!showText && (
                            <div className="text-center mt-[-3rem] relative z-10">
                                <span className="bg-white/80 px-4 py-2 rounded-full text-sm text-gray-500 shadow-sm border">
                                    Click "Show" to read the text
                                </span>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const QuizTab = () => {
            const [answers, setAnswers] = useState({});
            const [showResult, setShowResult] = useState(false);

            const handleOptionClick = (qId, optionIdx) => {
                if (showResult) return;
                setAnswers(prev => ({...prev, [qId]: optionIdx}));
            };

            const calculateScore = () => {
                let score = 0;
                QUIZ_QUESTIONS.forEach(q => {
                    if (answers[q.id] === q.correct) score++;
                });
                return score;
            };

            return (
                <div className="max-w-2xl mx-auto space-y-6">
                    {QUIZ_QUESTIONS.map((q, idx) => {
                        const userAnswer = answers[q.id];
                        const isCorrect = userAnswer === q.correct;
                        
                        return (
                            <div key={q.id} className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <h4 className="font-bold text-gray-800 mb-4 flex gap-2">
                                    <span className="bg-teal-100 text-teal-800 px-2 rounded">{idx + 1}</span>
                                    {q.question}
                                </h4>
                                <div className="space-y-2">
                                    {q.options.map((opt, optIdx) => (
                                        <button
                                            key={optIdx}
                                            onClick={() => handleOptionClick(q.id, optIdx)}
                                            className={`w-full text-left p-3 rounded-lg border transition-all ${
                                                showResult 
                                                    ? (optIdx === q.correct 
                                                        ? "bg-green-100 border-green-500 text-green-800 font-medium" 
                                                        : (userAnswer === optIdx ? "bg-red-100 border-red-500 text-red-800" : "border-gray-200 opacity-60"))
                                                    : (userAnswer === optIdx 
                                                        ? "bg-teal-50 border-teal-500 text-teal-700" 
                                                        : "border-gray-200 hover:bg-gray-50")
                                            }`}
                                        >
                                            <div className="flex items-center justify-between">
                                                <span>{opt}</span>
                                                {showResult && optIdx === q.correct && <Icon name="check-circle" size={16} color="green" />}
                                                {showResult && userAnswer === optIdx && userAnswer !== q.correct && <Icon name="x-circle" size={16} color="red" />}
                                            </div>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        );
                    })}

                    <div className="flex justify-center pt-4">
                        {!showResult ? (
                            <button 
                                onClick={() => setShowResult(true)}
                                disabled={Object.keys(answers).length < QUIZ_QUESTIONS.length}
                                className="bg-teal-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transform transition active:scale-95"
                            >
                                Submit Answers
                            </button>
                        ) : (
                            <div className="text-center animate-bounce-in">
                                <p className="text-2xl font-bold text-gray-800 mb-2">
                                    Your Score: <span className="text-teal-600">{calculateScore()} / {QUIZ_QUESTIONS.length}</span>
                                </p>
                                <button 
                                    onClick={() => { setShowResult(false); setAnswers({}); }}
                                    className="text-gray-500 underline hover:text-teal-600"
                                >
                                    Try Again
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const DictationTab = () => {
            const [isPlaying, setIsPlaying] = useState(false);
            const [userInput, setUserInput] = useState("");
            const [check, setCheck] = useState(null); // null, 'correct', 'incorrect'

            const handleSubmit = (e) => {
                e.preventDefault();
                const cleanInput = userInput.trim().toLowerCase().replace(/[.,]/g, "");
                const cleanTarget = DICTATION_SENTENCE.trim().toLowerCase().replace(/[.,]/g, "");
                
                if (cleanInput === cleanTarget) {
                    setCheck('correct');
                } else {
                    setCheck('incorrect');
                }
            };

            return (
                <div className="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-sm border border-gray-100 text-center">
                    <Icon name="pen-tool" size={48} className="mx-auto text-teal-500 mb-4" />
                    <h3 className="text-xl font-bold text-gray-800 mb-2">Dictation Challenge</h3>
                    <p className="text-gray-500 mb-6">Listen to the sentence and type exactly what you hear.</p>

                    <div className="flex justify-center mb-6">
                        <AudioControls 
                            text={DICTATION_SENTENCE} 
                            isPlaying={isPlaying} 
                            setIsPlaying={setIsPlaying}
                            rate={0.8} // Default slower for dictation
                            setRate={() => {}} // Disable rate change for simplicity here
                        />
                    </div>

                    <form onSubmit={handleSubmit} className="space-y-4">
                        <textarea 
                            value={userInput}
                            onChange={(e) => { setUserInput(e.target.value); setCheck(null); }}
                            className={`w-full p-4 rounded-lg border-2 focus:outline-none focus:ring-2 focus:ring-teal-200 transition-colors ${
                                check === 'correct' ? 'border-green-500 bg-green-50' : 
                                check === 'incorrect' ? 'border-red-500 bg-red-50' : 'border-gray-200'
                            }`}
                            placeholder="Type the sentence here..."
                            rows="3"
                        ></textarea>
                        
                        <button 
                            type="submit"
                            className="bg-teal-600 text-white px-6 py-2 rounded-full font-semibold hover:bg-teal-700"
                        >
                            Check Answer
                        </button>
                    </form>

                    {check === 'correct' && (
                        <div className="mt-4 text-green-600 font-bold flex items-center justify-center gap-2">
                            <Icon name="check" /> Perfect! Correct.
                        </div>
                    )}
                    {check === 'incorrect' && (
                        <div className="mt-4 text-red-500">
                            <p className="font-bold flex items-center justify-center gap-2"><Icon name="x" /> Not quite.</p>
                            <p className="text-sm text-gray-500 mt-1">Hint: Check your spelling and punctuation.</p>
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('listening');

            const tabs = [
                { id: 'vocab', label: '1. Vocabulary', icon: 'book-open' },
                { id: 'listening', label: '2. Listening', icon: 'headphones' },
                { id: 'quiz', label: '3. Quiz', icon: 'help-circle' },
                { id: 'dictation', label: '4. Dictation', icon: 'pencil' },
            ];

            return (
                <div className="min-h-screen pb-12">
                    <Header />
                    
                    <main className="max-w-4xl mx-auto px-4 mt-8">
                        {/* Tab Navigation */}
                        <div className="flex flex-wrap border-b border-gray-200 mb-8">
                            {tabs.map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex items-center gap-2 px-6 py-4 transition-all ${
                                        activeTab === tab.id 
                                            ? 'tab-active' 
                                            : 'tab-inactive hover:text-gray-800'
                                    }`}
                                >
                                    <Icon name={tab.icon} size={18} />
                                    {tab.label}
                                </button>
                            ))}
                        </div>

                        {/* Content Area */}
                        <div className="animate-fade-in">
                            {activeTab === 'vocab' && <VocabularyTab />}
                            {activeTab === 'listening' && <ListeningTab />}
                            {activeTab === 'quiz' && <QuizTab />}
                            {activeTab === 'dictation' && <DictationTab />}
                        </div>
                    </main>

                    <footer className="text-center text-gray-400 text-sm mt-12 py-6 border-t">
                        <p>© 2025 English Listening Lab. Generated for Educational Use.</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>