<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parrot Pal - English Learning</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Import Map helps browser find React modules -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.292.0"
      }
    }
    </script>
    
    <!-- Babel allows us to write JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Custom Animations */
        .rotate-y-180 { transform: rotateY(180deg); }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
        .animate-slide-up { animation: fade-in 0.5s ease-out forwards; }
        
        @keyframes bounce-custom {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bounce-custom { animation: bounce-custom 0.5s infinite; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake { animation: shake 0.3s ease-in-out; }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    
    <div id="root"></div>

    <!-- Main Application Script -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Volume2, BookOpen, Brain, PenTool, ArrowRight, RotateCcw, Check, Star, Mic, Play, Pause, Volume1, Ear, Keyboard, Headphones } from 'lucide-react';

        const App = () => {
          const [activeTab, setActiveTab] = useState('vocab');
          
          // --- Data ---
          const storyContent = {
            title: "The Grey Parrot: A Brilliant Bird",
            originalText: "The Grey Parrot is often known as the Einstein of the bird world. With its soft grey feathers and bright eyes, it is beautiful, but its brain is what makes it truly special. These parrots have sharp memories and can mimic human voices, copying not just words but also emotions. A famous parrot named Alex proved how smart they are by counting and recognizing colors. In African legends, these birds were seen as messengers to the gods. However, today they are in danger due to habitat loss and illegal trading. We need to protect these brilliant companions before it is too late.",
            translation: "ç°é¸šéµ¡å¸¸è¢«ç¨±ç‚ºé³¥é¡žç•Œçš„æ„›å› æ–¯å¦ã€‚ç‰ å€‘æ“æœ‰æŸ”è»Ÿçš„ç°è‰²ç¾½æ¯›å’Œæ˜Žäº®çš„çœ¼ç›ï¼Œå¤–è¡¨ç¾Žéº—ï¼Œä½†çœŸæ­£ç‰¹åˆ¥çš„æ˜¯ç‰ å€‘çš„å¤§è…¦ã€‚é€™äº›é¸šéµ¡è¨˜æ†¶åŠ›æ¥µä½³ï¼Œèƒ½æ¨¡ä»¿äººé¡žçš„è²éŸ³ï¼Œä¸åƒ…èƒ½è¤‡è£½è©žå½™ï¼Œé‚„èƒ½æ¨¡ä»¿æƒ…æ„Ÿã€‚ä¸€éš»åå« Alex çš„è‘—åé¸šéµ¡é€éŽæ•¸æ•¸å’Œè¾¨è­˜é¡è‰²è­‰æ˜Žäº†ç‰ å€‘æœ‰å¤šè°æ˜Žã€‚åœ¨éžæ´²å‚³èªªä¸­ï¼Œé€™äº›é³¥è¢«è¦–ç‚ºèˆ‡ç¥žæºé€šçš„ä¿¡ä½¿ã€‚ç„¶è€Œï¼Œä»Šå¤©ç‰ å€‘å› æ£²æ¯åœ°å–ªå¤±å’Œéžæ³•äº¤æ˜“è€Œé¢è‡¨å±éšªã€‚æˆ‘å€‘éœ€è¦åœ¨ç‚ºæ™‚å·²æ™šä¹‹å‰ä¿è­·é€™äº›è°æ˜Žçš„å¤¥ä¼´ã€‚"
          };

          // Update: Words are now lowercase
          const vocabList = [
            { id: 1, word: "imitate", part: "v.", def: "To copy the way someone speaks or moves.", zh: "æ¨¡ä»¿" },
            { id: 2, word: "capacity", part: "n.", def: "The ability to understand or do something.", zh: "èƒ½åŠ›ï¼›å®¹é‡" },
            { id: 3, word: "spiritual", part: "adj.", def: "Relating to deep feelings and beliefs, often religious.", zh: "ç²¾ç¥žçš„ï¼›å¿ƒéˆçš„" },
            { id: 4, word: "ritual", part: "n.", def: "A ceremony that is always performed in the same way.", zh: "å„€å¼" },
            { id: 5, word: "habitat", part: "n.", def: "The natural home of an animal or plant.", zh: "æ£²æ¯åœ°" },
            { id: 6, word: "beloved", part: "adj.", def: "Loved very much by someone.", zh: "æ‘¯æ„›çš„" },
            { id: 7, word: "companion", part: "n.", def: "A person or animal you spend a lot of time with.", zh: "åŒä¼´" },
            { id: 8, word: "serve as", part: "phr.", def: "To perform a particular function or role.", zh: "æ“”ä»»ï¼›å……ç•¶" },
            { id: 9, word: "stand out", part: "phr.", def: "To be very easy to see or notice.", zh: "çªå‡ºï¼›é¡¯çœ¼" }
          ];

          // Updated Gap Fill Data with Chinese translations
          const gapFillData = [
            {
              id: 1,
              text: "The grey parrot is famous for its ability to _____ human voices perfectly.",
              fullAudio: "The grey parrot is famous for its ability to imitate human voices perfectly.",
              answer: "imitate",
              zh: "ç°é¸šéµ¡ä»¥å®Œç¾Žæ¨¡ä»¿äººé¡žè²éŸ³çš„èƒ½åŠ›è€Œèžåã€‚"
            },
            {
              id: 2,
              text: "Sadly, the number of wild parrots has started to drop due to _____ loss.",
              fullAudio: "Sadly, the number of wild parrots has started to drop due to habitat loss.",
              answer: "habitat",
              zh: "éºæ†¾çš„æ˜¯ï¼Œç”±æ–¼æ£²æ¯åœ°å–ªå¤±ï¼Œé‡Žç”Ÿé¸šéµ¡çš„æ•¸é‡é–‹å§‹ä¸‹é™ã€‚"
            },
            {
              id: 3,
              text: "In some African cultures, feathers were used in a special _____.",
              fullAudio: "In some African cultures, feathers were used in a special ritual.",
              answer: "ritual",
              zh: "åœ¨ä¸€äº›éžæ´²æ–‡åŒ–ä¸­ï¼Œç¾½æ¯›è¢«ç”¨æ–¼ç‰¹æ®Šçš„å„€å¼ã€‚"
            },
             {
              id: 4,
              text: "Parrots are not just pets; they can be a wonderful _____.",
              fullAudio: "Parrots are not just pets; they can be a wonderful companion.",
              answer: "companion",
              zh: "é¸šéµ¡ä¸åƒ…åƒ…æ˜¯å¯µç‰©ï¼›ç‰ å€‘å¯ä»¥æ˜¯å¾ˆå¥½çš„åŒä¼´ã€‚"
            },
            {
              id: 5,
              text: "Their colorful feathers make them _____ from other birds.",
              fullAudio: "Their colorful feathers make them stand out from other birds.",
              answer: "stand out",
              zh: "ç‰ å€‘å¤šå½©çš„ç¾½æ¯›ä½¿ç‰ å€‘åœ¨å…¶ä»–é³¥é¡žä¸­è„«ç©Žè€Œå‡ºã€‚"
            }
          ];

          const quizData = [
            {
              id: 1,
              question: "What makes the grey parrot stand out most?",
              options: [
                "Its soft grey feathers.",
                "Its ability to fly fast.",
                "Its sharp memory and learning ability.",
                "Its large size."
              ],
              correct: 2
            },
            {
              id: 2,
              question: "Who was Alex?",
              options: [
                "A scientist who studied birds.",
                "A parrot that could count and recognize colors.",
                "A god in African mythology.",
                "A famous parrot trainer."
              ],
              correct: 1
            },
            {
              id: 3,
              question: "Why do grey parrots need protection?",
              options: [
                "They are losing their habitats.",
                "They are migrating too often.",
                "There are too many of them.",
                "They are attacking other birds."
              ],
              correct: 0
            }
          ];

          // --- Components ---

          const Header = () => (
            <div className="bg-gradient-to-r from-emerald-600 to-teal-500 text-white p-6 rounded-b-3xl shadow-lg mb-6 relative overflow-hidden">
              <div className="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10">
                <Star size={150} />
              </div>
              <div className="relative z-10">
                <h1 className="text-3xl font-bold flex items-center gap-3 mb-2">
                  <span className="text-4xl">ðŸ¦œ</span> Parrot Pal
                </h1>
                <p className="text-emerald-100 opacity-90">Learn English with the smartest bird in the world!</p>
              </div>
              
              <div className="flex space-x-2 mt-6 overflow-x-auto pb-2 scrollbar-hide">
                {[
                  { id: 'vocab', icon: Brain, label: 'Flashcards' },
                  { id: 'gapfill', icon: Ear, label: 'Listening & Spelling' },
                  { id: 'listening', icon: Headphones, label: 'Short Passage Listening' }, // Merged Story & Quiz
                ].map((tab) => (
                  <button
                    key={tab.id}
                    onClick={() => setActiveTab(tab.id)}
                    className={`flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold transition-all whitespace-nowrap ${
                      activeTab === tab.id 
                        ? 'bg-white text-emerald-600 shadow-md transform scale-105' 
                        : 'bg-emerald-700/50 text-emerald-100 hover:bg-emerald-700'
                    }`}
                  >
                    <tab.icon size={16} />
                    {tab.label}
                  </button>
                ))}
              </div>
            </div>
          );

          // --- Flashcard Section ---
          const FlashcardSection = () => {
            const [flipped, setFlipped] = useState({});

            const toggleFlip = (id) => {
              setFlipped(prev => ({ ...prev, [id]: !prev[id] }));
            };

            const playWord = (e, text) => {
                e.stopPropagation();
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    window.speechSynthesis.speak(utterance);
                }
            };

            return (
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 p-2">
                {vocabList.map((vocab) => (
                  <div 
                    key={vocab.id} 
                    onClick={() => toggleFlip(vocab.id)}
                    className="h-56 cursor-pointer perspective-1000 group"
                  >
                    <div className={`relative w-full h-full transition-transform duration-700 transform-style-3d shadow-xl rounded-2xl ${flipped[vocab.id] ? 'rotate-y-180' : ''}`}>
                      
                      {/* Front of Card */}
                      <div className="absolute w-full h-full bg-white rounded-2xl flex flex-col items-center justify-center backface-hidden border-b-4 border-emerald-500 shadow-sm z-20">
                         {/* Audio Button - Positioned so it doesn't overlap text */}
                         <button 
                            onClick={(e) => playWord(e, vocab.word)}
                            className="absolute top-4 right-4 w-10 h-10 flex items-center justify-center bg-emerald-100 text-emerald-600 rounded-full hover:bg-emerald-500 hover:text-white transition-all shadow-sm z-30"
                            title="Listen"
                        >
                            <Volume1 size={20} />
                        </button>
                        
                        <div className="text-center px-4">
                            <span className="block text-xs font-bold text-emerald-400 uppercase tracking-widest mb-3">Vocabulary</span>
                            {/* Updated to lowercase via data, just displaying as is */}
                            <h3 className="text-3xl font-extrabold text-gray-800 tracking-tight">{vocab.word}</h3>
                            <div className="mt-4 flex items-center justify-center gap-2 text-gray-400 text-xs">
                                <RotateCcw size={12} />
                                <span>Tap to flip</span>
                            </div>
                        </div>
                      </div>

                      {/* Back of Card */}
                      <div className="absolute w-full h-full bg-emerald-600 text-white rounded-2xl flex flex-col items-center justify-center backface-hidden rotate-y-180 p-6 text-center z-10">
                        <span className="inline-block px-3 py-1 bg-emerald-700 rounded-full text-xs font-mono mb-3 shadow-inner">{vocab.part}</span>
                        <h4 className="text-2xl font-bold mb-3">{vocab.zh}</h4>
                        <p className="text-sm text-emerald-100 leading-relaxed font-medium">{vocab.def}</p>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            );
          };

          // --- Gap Fill Section with Spelling, Listening & Translation ---
          const GapFillSection = () => {
            const [inputs, setInputs] = useState({});
            const [status, setStatus] = useState({}); // 'correct' | 'incorrect' | null
            const [playingId, setPlayingId] = useState(null);

            const handleInputChange = (id, value) => {
              setInputs(prev => ({ ...prev, [id]: value }));
              if (status[id]) {
                setStatus(prev => ({ ...prev, [id]: null })); 
              }
            };

            const playAudio = (id, text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.85; 
                    utterance.onstart = () => setPlayingId(id);
                    utterance.onend = () => setPlayingId(null);
                    window.speechSynthesis.speak(utterance);
                }
            };

            const checkAnswer = (item) => {
                const userAns = (inputs[item.id] || "").trim().toLowerCase();
                const correctAns = item.answer.toLowerCase();

                if (userAns === correctAns) {
                    setStatus(prev => ({ ...prev, [item.id]: 'correct' }));
                } else {
                    setStatus(prev => ({ ...prev, [item.id]: 'incorrect' }));
                }
            };

            return (
              <div className="space-y-6">
                <div className="bg-emerald-50 border border-emerald-100 p-4 rounded-xl flex items-start gap-3 mb-6">
                    <div className="bg-emerald-100 p-2 rounded-full text-emerald-600 mt-1">
                        <Ear size={20} />
                    </div>
                    <div>
                        <h3 className="font-bold text-emerald-800">How to play:</h3>
                        <p className="text-sm text-emerald-700 mt-1">Click the <Volume2 size={14} className="inline"/> button to listen to the full sentence. Type the missing word in the box.</p>
                    </div>
                </div>

                {gapFillData.map((item) => (
                  <div key={item.id} className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all hover:shadow-md">
                    
                    {/* Audio Control */}
                    <button 
                        onClick={() => playAudio(item.id, item.fullAudio)}
                        className={`mb-4 flex items-center gap-2 px-4 py-2 rounded-full text-sm font-bold transition-all w-full sm:w-auto justify-center ${
                            playingId === item.id 
                            ? 'bg-emerald-100 text-emerald-600 ring-2 ring-emerald-400' 
                            : 'bg-gray-100 text-gray-600 hover:bg-emerald-50 hover:text-emerald-600'
                        }`}
                    >
                        {playingId === item.id ? <Volume2 size={18} className="animate-pulse"/> : <Play size={18} />}
                        {playingId === item.id ? "Listening..." : "Listen to Sentence"}
                    </button>

                    {/* Sentence with Gap */}
                    <div className="text-lg text-gray-800 font-medium leading-relaxed mb-4">
                        {item.text.split('_____')[0]}
                        <span className="inline-block px-2 py-0.5 bg-gray-100 rounded text-gray-400 font-mono text-base border border-dashed border-gray-300 mx-1">MISSING WORD</span>
                        {item.text.split('_____')[1]}
                    </div>

                    {/* Input Area */}
                    <div className="flex flex-col sm:flex-row gap-3 items-stretch sm:items-center mt-2">
                        <div className="relative flex-grow">
                            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                <Keyboard size={18} />
                            </div>
                            <input
                                type="text"
                                value={inputs[item.id] || ''}
                                onChange={(e) => handleInputChange(item.id, e.target.value)}
                                placeholder="Type the word here..."
                                disabled={status[item.id] === 'correct'}
                                className={`pl-10 block w-full rounded-xl border-2 px-4 py-3 focus:outline-none focus:ring-0 transition-colors text-lg font-bold ${
                                    status[item.id] === 'correct' ? 'border-green-500 bg-green-50 text-green-700' :
                                    status[item.id] === 'incorrect' ? 'border-red-300 bg-red-50 text-red-900 animate-shake' :
                                    'border-gray-200 focus:border-emerald-400 bg-white'
                                }`}
                            />
                            {status[item.id] === 'correct' && (
                                <div className="absolute inset-y-0 right-0 pr-3 flex items-center text-green-500 animate-bounce-custom">
                                    <Check size={24} strokeWidth={3} />
                                </div>
                            )}
                        </div>

                        <button
                            onClick={() => checkAnswer(item)}
                            disabled={!inputs[item.id] || status[item.id] === 'correct'}
                            className={`px-6 py-3 rounded-xl font-bold text-white transition-all shadow-sm ${
                                status[item.id] === 'correct' 
                                ? 'bg-green-500 cursor-default' 
                                : !inputs[item.id] 
                                    ? 'bg-gray-300 cursor-not-allowed' 
                                    : 'bg-emerald-600 hover:bg-emerald-700 active:scale-95'
                            }`}
                        >
                            {status[item.id] === 'correct' ? 'Great!' : 'Check'}
                        </button>
                    </div>
                    
                    {/* Feedback & Translation Section - Updated */}
                    <div className="min-h-[1.5rem] mt-2">
                         {status[item.id] === 'incorrect' && (
                            <p className="text-sm text-red-500 font-medium pl-1">Not quite right. Listen again!</p>
                        )}
                        {status[item.id] === 'correct' && (
                            <div className="animate-fade-in p-3 bg-green-50 rounded-lg border border-green-100 mt-2">
                                <p className="text-green-800 font-bold mb-1">Correct!</p>
                                <p className="text-emerald-600 font-medium">{item.zh}</p>
                            </div>
                        )}
                    </div>
                  </div>
                ))}
              </div>
            );
          };

          // --- Merged Listening & Quiz Section ---
          const ListeningComprehensionSection = () => {
            const [isPlaying, setIsPlaying] = useState(false);
            const [rate, setRate] = useState(0.9);
            const [showText, setShowText] = useState(true); // Default show text, toggleable
            const [showTranslation, setShowTranslation] = useState(false);
            
            // Quiz State
            const [selected, setSelected] = useState({});
            const [score, setScore] = useState(null);

            // --- TTS Logic ---
            const speak = () => {
              if ('speechSynthesis' in window) {
                if (isPlaying) {
                  window.speechSynthesis.cancel();
                  setIsPlaying(false);
                } else {
                  const utterance = new SpeechSynthesisUtterance(storyContent.originalText);
                  utterance.lang = 'en-US';
                  utterance.rate = rate;
                  utterance.onend = () => setIsPlaying(false);
                  window.speechSynthesis.speak(utterance);
                  setIsPlaying(true);
                }
              } else {
                alert("Sorry, your browser doesn't support text-to-speech!");
              }
            };

            useEffect(() => {
              return () => {
                window.speechSynthesis.cancel();
              };
            }, []);

            // --- Quiz Logic ---
            const handleSelect = (qId, optionIdx) => {
              if (score !== null) return;
              setSelected(prev => ({ ...prev, [qId]: optionIdx }));
            };

            const submitQuiz = () => {
              let correctCount = 0;
              quizData.forEach(q => {
                if (selected[q.id] === q.correct) correctCount++;
              });
              setScore(correctCount);
            };

            const resetQuiz = () => {
              setSelected({});
              setScore(null);
            };

            return (
              <div className="space-y-8 animate-slide-up">
                
                {/* Part 1: Story & Audio Player */}
                <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                  <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4 border-b border-gray-100 pb-4">
                    <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                        <BookOpen size={24} className="text-emerald-500"/>
                        {storyContent.title}
                    </h2>
                  </div>

                  {/* Audio Controls */}
                  <div className="bg-emerald-50 p-4 rounded-xl flex flex-wrap items-center gap-4 mb-6">
                    <button 
                      onClick={speak}
                      className={`flex items-center gap-2 px-6 py-3 rounded-xl font-bold transition-all shadow-md ${
                        isPlaying 
                        ? 'bg-red-500 text-white hover:bg-red-600' 
                        : 'bg-emerald-600 text-white hover:bg-emerald-700'
                      }`}
                    >
                      {isPlaying ? <><Pause size={20} /> Stop Audio</> : <><Play size={20} /> Play Audio</>}
                    </button>
                    
                    <div className="flex items-center gap-2 bg-white px-3 py-2 rounded-lg border border-emerald-100">
                        <span className="text-xs font-bold text-gray-500 uppercase">Speed</span>
                        <input 
                          type="range" 
                          min="0.5" 
                          max="1.2" 
                          step="0.1" 
                          value={rate} 
                          onChange={(e) => setRate(parseFloat(e.target.value))}
                          className="w-24 accent-emerald-500"
                        />
                        <span className="text-xs font-mono w-8 text-right">{rate}x</span>
                    </div>

                    <div className="flex-grow"></div>

                    <button 
                        onClick={() => setShowText(!showText)}
                        className="text-sm font-semibold text-emerald-600 hover:text-emerald-800 underline decoration-dotted"
                    >
                        {showText ? "Hide Text" : "Show Text"}
                    </button>
                  </div>

                  {/* Text Display */}
                  {showText && (
                    <div className="animate-fade-in">
                        <div className="prose prose-lg text-gray-700 leading-relaxed mb-6 p-4 bg-gray-50 rounded-xl border border-gray-100">
                        <p>{storyContent.originalText}</p>
                        </div>

                        <div className="flex justify-end">
                        <button 
                            onClick={() => setShowTranslation(!showTranslation)}
                            className="text-emerald-600 text-sm font-semibold hover:text-emerald-700 flex items-center gap-1"
                        >
                            {showTranslation ? 'Hide Translation' : 'Show Translation'} <ArrowRight size={14} className={showTranslation ? 'rotate-90 transition-transform' : 'transition-transform'} />
                        </button>
                        </div>
                        
                        {showTranslation && (
                        <div className="mt-4 p-4 bg-emerald-100/50 rounded-lg text-gray-800 text-sm leading-relaxed animate-fade-in border border-emerald-100">
                            {storyContent.translation}
                        </div>
                        )}
                    </div>
                  )}
                  {!showText && (
                      <div className="text-center py-8 bg-gray-50 rounded-xl border border-dashed border-gray-300 text-gray-400 italic">
                          Text hidden. Listen carefully to the audio!
                      </div>
                  )}
                </div>

                {/* Part 2: Comprehension Quiz */}
                <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h2 className="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2 border-b border-gray-100 pb-2">
                        <Check size={24} className="text-emerald-500"/>
                        Comprehension Quiz
                    </h2>

                    <div className="space-y-6">
                        {quizData.map((q, idx) => {
                        const isSubmitted = score !== null;
                        
                        return (
                            <div key={q.id} className="bg-gray-50 p-5 rounded-xl border border-gray-100">
                            <h3 className="text-lg font-bold text-gray-800 mb-4">
                                <span className="text-emerald-500 mr-2">Q{idx + 1}.</span>
                                {q.question}
                            </h3>
                            
                            <div className="space-y-3">
                                {q.options.map((opt, optIdx) => {
                                let btnClass = "w-full text-left p-3 rounded-lg border-2 transition-all text-sm font-medium ";
                                
                                if (isSubmitted) {
                                    if (optIdx === q.correct) btnClass += "border-green-500 bg-green-50 text-green-700 font-bold";
                                    else if (selected[q.id] === optIdx && optIdx !== q.correct) btnClass += "border-red-400 bg-red-50 text-red-700 opacity-70";
                                    else btnClass += "border-gray-200 text-gray-400 bg-white";
                                } else {
                                    if (selected[q.id] === optIdx) btnClass += "border-emerald-500 bg-emerald-50 text-emerald-700 shadow-sm";
                                    else btnClass += "border-gray-200 hover:border-emerald-300 text-gray-600 bg-white hover:bg-emerald-50";
                                }

                                return (
                                    <button
                                    key={optIdx}
                                    onClick={() => handleSelect(q.id, optIdx)}
                                    className={btnClass}
                                    >
                                    <div className="flex items-center justify-between">
                                        <span>{opt}</span>
                                        {isSubmitted && optIdx === q.correct && <Check size={18} />}
                                    </div>
                                    </button>
                                );
                                })}
                            </div>
                            </div>
                        );
                        })}

                        {/* Quiz Controls */}
                        <div className="bg-emerald-50 p-4 rounded-xl border border-emerald-100 flex items-center justify-between mt-6">
                        <div>
                            {score !== null ? (
                            <div className="text-lg font-bold">
                                Score: <span className={score === quizData.length ? "text-green-600 text-2xl" : "text-emerald-600 text-2xl"}>{score}</span> / {quizData.length}
                                {score === quizData.length && <span className="ml-2">ðŸŽ‰ Perfect!</span>}
                            </div>
                            ) : (
                            <span className="text-gray-500 text-sm italic">Answer all questions to submit</span>
                            )}
                        </div>
                        
                        {score === null ? (
                            <button
                            onClick={submitQuiz}
                            disabled={Object.keys(selected).length !== quizData.length}
                            className={`px-8 py-3 rounded-xl font-bold text-white transition-all ${
                                Object.keys(selected).length !== quizData.length 
                                ? 'bg-gray-300 cursor-not-allowed' 
                                : 'bg-emerald-600 hover:bg-emerald-700 shadow-lg hover:shadow-xl transform hover:-translate-y-1'
                            }`}
                            >
                            Submit Answers
                            </button>
                        ) : (
                            <button
                            onClick={resetQuiz}
                            className="flex items-center gap-2 px-6 py-2 rounded-xl font-bold bg-gray-800 text-white hover:bg-gray-900 transition-all shadow-lg"
                            >
                            <RotateCcw size={18} /> Retry Quiz
                            </button>
                        )}
                        </div>
                    </div>
                </div>
              </div>
            );
          };

          return (
            <div className="max-w-3xl mx-auto px-4 pt-4 pb-10">
              <Header />
              
              <main className="animate-slide-up">
                {activeTab === 'vocab' && <FlashcardSection />}
                {activeTab === 'gapfill' && <GapFillSection />}
                {activeTab === 'listening' && <ListeningComprehensionSection />}
              </main>

              <footer className="mt-12 text-center text-gray-400 text-sm">
                <p>Â© 2025 Parrot Pal Learning. Based on "The Grey Parrot".</p>
              </footer>
            </div>
          );
        };

        // Mount the app
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>